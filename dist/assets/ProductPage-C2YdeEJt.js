import{u as H,j as e,L as A,A as T,a as W,P as _}from"./index-ByxEemcU.js";import{r}from"./vendor-CIP6LD3P.js";const G=({productId:o,onBack:f,onSelectSubcategory:M,onViewProduct:B,onQuickView:E,favoriteIds:d,onToggleFavorite:j})=>{const[v,i]=r.useState(1),[s,x]=r.useState(null),[b,y]=r.useState([]),[D,w]=r.useState(!0),[N,R]=r.useState(null),{currentUser:$,token:C}=H(),[m,k]=r.useState(""),[u,S]=r.useState(0),[q,h]=r.useState(0),[L,P]=r.useState(!1),[z,g]=r.useState(null),p=r.useMemo(()=>s?d.includes(s.id):!1,[s,d]);r.useEffect(()=>{(async()=>{w(!0),R(null),x(null),y([]);try{const[a,l]=await Promise.all([fetch(`/api/products/${o}`),fetch(`/api/products/${o}/related`)]);if(!a.ok){const c=await a.json();throw new Error(c.message||"Product not found")}const n=await a.json();if(x(n),l.ok){const c=await l.json();y(c)}}catch(a){R(a.message)}finally{w(!1)}})()},[o]);const V=t=>{const a=t.target.value.replace(/[^0-9]/g,""),l=parseInt(a,10);!isNaN(l)&&l>0?i(l):a===""&&i(1)},I=t=>{(t.target.value===""||parseInt(t.target.value,10)<1)&&i(1)},Q=async t=>{if(t.preventDefault(),u===0||m.trim()===""){g("Veuillez donner une note et un commentaire.");return}if(!(!C||!s)){P(!0),g(null);try{const a=await fetch(`/api/products/${s.id}/reviews`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify({rating:u,comment:m})}),l=await a.json();if(!a.ok)throw new Error(l.message||"Impossible d'ajouter l'avis.");x(n=>{if(!n)return null;const c=[l,...n.reviews||[]];return{...n,reviews:c}}),k(""),S(0),h(0)}catch(a){g(a.message)}finally{P(!1)}}};if(D)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(A,{})});if(N||!s)return e.jsx("div",{className:"bg-white flex-grow",children:e.jsxs("div",{className:"text-center py-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-20 w-20 text-red-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Oups ! Produit non trouvé."}),e.jsx("p",{className:"text-gray-600 mt-2 mb-6 max-w-md",children:N||"Le produit que vous cherchez n'existe pas ou a été déplacé."}),e.jsx("button",{onClick:f,className:"mt-4 px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-semibold",children:"Retour à la boutique"})]})});const F=t=>{t.preventDefault(),M(s.subcategory)},O=()=>{s&&j(s.id)};return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("div",{className:"bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx("nav",{"aria-label":"Breadcrumb",className:"text-sm text-gray-500 mb-8",children:e.jsxs("ol",{className:"list-none p-0 inline-flex",children:[e.jsx("li",{className:"flex items-center",children:e.jsx("a",{href:"#",onClick:t=>{t.preventDefault(),f()},className:"hover:text-teal-600 hover:underline",children:"Accueil"})}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-gray-400 mx-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-semibold text-gray-500",children:s.category})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-gray-400 mx-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),e.jsx("a",{href:"#",onClick:F,className:"hover:text-teal-600 hover:underline",children:s.subcategory})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[e.jsx("div",{className:"bg-gray-100 rounded-lg p-8 flex items-center justify-center aspect-square",children:e.jsx(T,{product:s,className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[s.isSecondHand&&e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:"bg-orange-100 text-orange-800 text-sm font-medium mr-2 px-3 py-1 rounded-full",children:"Article de Seconde Main"})}),e.jsxs("div",{className:"flex justify-between items-start mb-4 gap-4",children:[e.jsx("h1",{className:"text-4xl font-extrabold text-gray-900 flex-1",children:s.name}),e.jsx("button",{onClick:O,"aria-label":"Ajouter aux favoris",className:`flex-shrink-0 bg-gray-100 rounded-full p-3 transition-colors ${p?"text-red-500":"text-gray-600 hover:text-red-500 hover:bg-red-50"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7",viewBox:"0 0 20 20",fill:p?"currentColor":"none",stroke:"currentColor",strokeWidth:p?0:1.5,children:e.jsx("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"flex items-baseline gap-3 mb-6",children:[e.jsxs("p",{className:`font-bold text-3xl ${s.originalPrice?"text-red-600":"text-teal-600"}`,children:[s.price," €"]}),s.originalPrice&&e.jsxs("p",{className:"text-gray-500 line-through text-xl",children:[s.originalPrice," €"]})]}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-8",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("label",{htmlFor:"quantity",className:"font-semibold",children:"Quantité :"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>i(t=>Math.max(1,t-1)),className:"w-10 h-10 border rounded-l-md flex items-center justify-center text-lg font-bold hover:bg-gray-100 transition-colors","aria-label":"Diminuer la quantité",children:"-"}),e.jsx("input",{id:"quantity",type:"text",value:v,onChange:V,onBlur:I,pattern:"[0-9]*",className:"w-12 h-10 text-center border-t border-b flex items-center justify-center font-semibold bg-white"}),e.jsx("button",{onClick:()=>i(t=>t+1),className:"w-10 h-10 border rounded-r-md flex items-center justify-center text-lg font-bold hover:bg-gray-100 transition-colors","aria-label":"Augmenter la quantité",children:"+"})]})]}),e.jsx("div",{className:"w-full max-w-sm",children:e.jsx(W,{product:s,quantity:v,className:"text-lg py-4 shadow-lg hover:shadow-xl transform hover:-translate-y-1"})})]})]})]})}),e.jsx("div",{className:"bg-white border-t border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 mb-6",children:"Avis des clients"}),s.reviews&&s.reviews.length>0?e.jsx("div",{className:"space-y-6",children:s.reviews.map((t,a)=>e.jsxs("div",{className:"border-b pb-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("p",{className:"font-bold text-gray-800",children:t.author}),e.jsx("div",{className:"flex items-center ml-4",children:[...Array(5)].map((l,n)=>e.jsx("svg",{className:`w-5 h-5 ${n<t.rating?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},n))})]}),e.jsx("p",{className:"text-gray-600",children:t.comment})]},t.id||a))}):e.jsx("p",{className:"text-gray-500 bg-gray-50 p-6 rounded-lg",children:"Il n'y a pas encore d'avis pour ce produit. Soyez le premier !"})]}),$&&e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Laisser un avis"}),e.jsxs("form",{onSubmit:Q,className:"bg-gray-50 p-6 rounded-lg border sticky top-24",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Votre note"}),e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((t,a)=>{const l=a+1;return e.jsx("button",{type:"button",onClick:()=>S(l),onMouseEnter:()=>h(l),onMouseLeave:()=>h(0),className:"text-gray-300","aria-label":`Noter ${l} sur 5`,children:e.jsx("svg",{className:`w-7 h-7 transition-colors ${(q||u)>=l?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})},l)})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700",children:"Votre commentaire"}),e.jsx("textarea",{id:"comment",rows:4,value:m,onChange:t=>k(t.target.value),className:"w-full mt-1 p-2 border border-gray-300 rounded-md shadow-sm",placeholder:"Partagez votre expérience avec ce produit..."})]}),z&&e.jsx("p",{className:"text-red-500 text-sm mb-4",children:z}),e.jsx("button",{type:"submit",disabled:L,className:"w-full bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700 disabled:bg-gray-400 flex justify-center items-center h-10",children:L?e.jsx(A,{}):"Envoyer l'avis"})]})]})]})})}),b.length>0&&e.jsx("div",{className:"bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 mb-8 text-center md:text-left",children:"Vous aimerez aussi"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-8",children:b.map(t=>e.jsx(_,{product:t,onView:B,onQuickView:E,favoriteIds:d,onToggleFavorite:j},t.id))})]})})]})};export{G as default};
